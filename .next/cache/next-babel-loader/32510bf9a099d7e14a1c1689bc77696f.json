{"ast":null,"code":"import _regeneratorRuntime from\"@babel/runtime/regenerator\";import _slicedToArray from\"@babel/runtime/helpers/slicedToArray\";import _toConsumableArray from\"@babel/runtime/helpers/toConsumableArray\";var _jsxFileName=\"/home/andrii/Addspire/Kepp alive/test_keepalive_web/pages/index.js\";var __jsx=React.createElement;import React,{useState}from\"react\";import StyleSheet from\"react-native-web/dist/exports/StyleSheet\";import Text from\"react-native-web/dist/exports/Text\";import TouchableOpacity from\"react-native-web/dist/exports/TouchableOpacity\";import View from\"react-native-web/dist/exports/View\";var sourceWith;var sourceWithout;var timerWith;export default function App(){var _this=this;var _useState=useState([]),withChecks=_useState[0],setWithChecks=_useState[1];var _useState2=useState([]),withoutChecks=_useState2[0],setWithoutChecks=_useState2[1];var _useState3=useState(false),withChecksRunning=_useState3[0],setWithChecksRunning=_useState3[1];var addLog=function addLog(text,without){if(without)setWithoutChecks([{time:Date().toString(),text:text}].concat(_toConsumableArray(withoutChecks)));else setWithChecks([{time:Date().toString(),text:text}].concat(_toConsumableArray(withChecks)));};var startPoll=function startPoll(){return _regeneratorRuntime.async(function startPoll$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;if(!withChecksRunning){_context.next=4;break;}addLog(\"already running\");return _context.abrupt(\"return\");case 4:addLog(\"starting\");setWithChecksRunning(true);if(sourceWith)sourceWith.close();if(timerWith)clearTimeout(timerWith);source=new SSE(getBaseURL()+\"/document/poll\",{headers:{\"Content-Type\":\"application/json\"},payload:JSON.stringify({pollResources:pollResources})});timerClose=setTimeout(function(){addLog(\"starting\");setWithChecksRunning(false);},20000);source.addEventListener(\"message\",function(e){setData({serverDown:false});var news=JSON.parse(e.data);console.log(\"message\",news);switch(news.messageCode){case\"updateResource\":props.updateResource(news.code,news.id,news.update,function(){return fetchData([news.id],news.code);});break;case\"addResource\":props.saveResource(news.resources,news.type);break;case\"notFoundResource\":props.addNotFoundResources(news._id);break;case\"ping\":if(timerClose)clearTimeout(timerClose);timerClose=setTimeout(function(){delete poll.resources;startPoll(pollResources,_reqNum);},20000);break;case\"updateLocale\":if(news.value&&news.value.length===3){var _news$value=_slicedToArray(news.value,3),name=_news$value[0],version=_news$value[1],locale=_news$value[2];AsyncStorage.setItem(\"\".concat(name,\"_v\"),version);AsyncStorage.setItem(\"\".concat(name,\"_l\"),JSON.stringify(locale));setData({languageUpdated:true});}break;case\"noLocale\":if(news.value){if(props.store.language===news.value){setData({language:\"en\"});}lastTimeConstantsRefreshed=0;}break;case\"refreshConstants\":if(news.value)setData(news.value);lastTimeConstantsRefreshed=dayjs().valueOf();break;}});source.addEventListener(\"error\",function(){setTimeout(function(){checkResourcesToPoll(_reqNum);},10000);});source.stream();_context.next=18;break;case 15:_context.prev=15;_context.t0=_context[\"catch\"](0);setTimeout(function(){checkResourcesToPoll(_reqNum);},10000);case 18:case\"end\":return _context.stop();}}},null,null,[[0,15]],Promise);};return __jsx(View,{style:styles.container,__self:this,__source:{fileName:_jsxFileName,lineNumber:120,columnNumber:9}},__jsx(TouchableOpacity,{style:{margin:10,padding:10,backgroundColor:\"green\",color:\"white\"},__self:this,__source:{fileName:_jsxFileName,lineNumber:121,columnNumber:13}},\"Start poll (checks every 20 sec)\"),__jsx(TouchableOpacity,{style:{margin:10,padding:10,backgroundColor:\"red\",color:\"white\"},__self:this,__source:{fileName:_jsxFileName,lineNumber:131,columnNumber:13}},\"Stop poll\"),__jsx(TouchableOpacity,{onPress:function onPress(){return setWithChecks([]);},style:{margin:10,padding:10,backgroundColor:\"grey\",color:\"white\"},__self:this,__source:{fileName:_jsxFileName,lineNumber:141,columnNumber:13}},\"Clear log\"),__jsx(Text,{__self:this,__source:{fileName:_jsxFileName,lineNumber:152,columnNumber:13}},\"Log\"),withChecks.map(function(item){return __jsx(View,{style:{flexDirection:\"row\",flex:1},__self:_this,__source:{fileName:_jsxFileName,lineNumber:154,columnNumber:17}},__jsx(View,{__self:_this,__source:{fileName:_jsxFileName,lineNumber:155,columnNumber:21}},__jsx(Text,{__self:_this,__source:{fileName:_jsxFileName,lineNumber:156,columnNumber:25}},item.time)),__jsx(View,{__self:_this,__source:{fileName:_jsxFileName,lineNumber:158,columnNumber:21}},__jsx(Text,{__self:_this,__source:{fileName:_jsxFileName,lineNumber:159,columnNumber:25}},item.text)));}),__jsx(TouchableOpacity,{style:{margin:10,padding:10,backgroundColor:\"green\",color:\"white\"},__self:this,__source:{fileName:_jsxFileName,lineNumber:164,columnNumber:13}},\"Start without checks\"),__jsx(TouchableOpacity,{style:{margin:10,padding:10,backgroundColor:\"red\",color:\"white\"},__self:this,__source:{fileName:_jsxFileName,lineNumber:174,columnNumber:13}},\"Stop\"),__jsx(TouchableOpacity,{onPress:function onPress(){return setWithChecks([]);},style:{margin:10,padding:10,backgroundColor:\"grey\",color:\"white\"},__self:this,__source:{fileName:_jsxFileName,lineNumber:184,columnNumber:13}},\"Clear log\"),__jsx(Text,{__self:this,__source:{fileName:_jsxFileName,lineNumber:195,columnNumber:13}},\"Log\"),withChecks.map(function(item){return __jsx(View,{style:{flexDirection:\"row\",flex:1},__self:_this,__source:{fileName:_jsxFileName,lineNumber:197,columnNumber:17}},__jsx(View,{__self:_this,__source:{fileName:_jsxFileName,lineNumber:198,columnNumber:21}},__jsx(Text,{__self:_this,__source:{fileName:_jsxFileName,lineNumber:199,columnNumber:25}},item.time)),__jsx(View,{__self:_this,__source:{fileName:_jsxFileName,lineNumber:201,columnNumber:21}},__jsx(Text,{__self:_this,__source:{fileName:_jsxFileName,lineNumber:202,columnNumber:25}},item.text)));}));}var styles=StyleSheet.create({container:{flex:1},text:{fontSize:16}});","map":{"version":3,"sources":["/home/andrii/Addspire/Kepp alive/test_keepalive_web/pages/index.js"],"names":["withChecks","setWithChecks","useState","withoutChecks","setWithoutChecks","withChecksRunning","setWithChecksRunning","addLog","time","Date","text","startPoll","sourceWith","clearTimeout","source","getBaseURL","headers","payload","pollResources","timerClose","setTimeout","setData","serverDown","news","JSON","e","console","props","fetchData","poll","name","version","locale","AsyncStorage","languageUpdated","language","lastTimeConstantsRefreshed","dayjs","checkResourcesToPoll","styles","margin","padding","backgroundColor","color","flexDirection","flex","item","container","fontSize"],"mappings":"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","sourcesContent":["// @generated: @expo/next-adapter@2.1.52\nimport React, { useState } from \"react\";\nimport { StyleSheet, Text, TouchableOpacity, View } from \"react-native\";\n\nlet sourceWith;\nlet sourceWithout;\n\nlet timerWith;\n\nexport default function App() {\n    const [withChecks, setWithChecks] = useState([]);\n    const [withoutChecks, setWithoutChecks] = useState([]);\n    const [withChecksRunning, setWithChecksRunning] = useState(false);\n\n    const addLog = (text, without) => {\n        if (without)\n            setWithoutChecks([\n                { time: Date().toString(), text },\n                ...withoutChecks,\n            ]);\n        else setWithChecks([{ time: Date().toString(), text }, ...withChecks]);\n    };\n\n    const startPoll = async () => {\n        try {\n            if (withChecksRunning) {\n                addLog(\"already running\");\n                return;\n            }\n            addLog(\"starting\");\n            setWithChecksRunning(true);\n\n            if (sourceWith) sourceWith.close();\n            if (timerWith) clearTimeout(timerWith);\n\n            source = new SSE(getBaseURL() + \"/document/poll\", {\n                headers: { \"Content-Type\": \"application/json\" },\n                payload: JSON.stringify({ pollResources }),\n            });\n\n            timerClose = setTimeout(() => {\n                addLog(\"starting\");\n\n                setWithChecksRunning(false);\n            }, 20000);\n            source.addEventListener(\"message\", (e) => {\n                setData({ serverDown: false });\n                const news = JSON.parse(e.data);\n                console.log(\"message\", news);\n                switch (news.messageCode) {\n                    case \"updateResource\":\n                        props.updateResource(\n                            news.code,\n                            news.id,\n                            news.update,\n                            () => fetchData([news.id], news.code)\n                        );\n                        break;\n                    case \"addResource\":\n                        props.saveResource(news.resources, news.type);\n                        break;\n                    case \"notFoundResource\":\n                        props.addNotFoundResources(news._id);\n                        break;\n                    case \"ping\":\n                        if (timerClose) clearTimeout(timerClose);\n                        timerClose = setTimeout(() => {\n                            delete poll.resources;\n                            startPoll(pollResources, _reqNum);\n                        }, 20000);\n\n                        break;\n                    case \"updateLocale\":\n                        if (news.value && news.value.length === 3) {\n                            const [name, version, locale] = news.value;\n                            AsyncStorage.setItem(`${name}_v`, version);\n                            AsyncStorage.setItem(\n                                `${name}_l`,\n                                JSON.stringify(locale)\n                            );\n\n                            setData({\n                                languageUpdated: true,\n                            });\n                        }\n                        break;\n                    case \"noLocale\":\n                        if (news.value) {\n                            if (props.store.language === news.value) {\n                                setData({\n                                    language: \"en\",\n                                });\n                            }\n                            lastTimeConstantsRefreshed = 0;\n                        }\n                        break;\n                    case \"refreshConstants\":\n                        if (news.value) setData(news.value);\n\n                        lastTimeConstantsRefreshed = dayjs().valueOf();\n\n                        break;\n                }\n            });\n\n            source.addEventListener(\"error\", function () {\n                setTimeout(() => {\n                    checkResourcesToPoll(_reqNum);\n                }, 10000);\n            });\n\n            source.stream();\n        } catch (error) {\n            setTimeout(() => {\n                checkResourcesToPoll(_reqNum);\n            }, 10000);\n        }\n    };\n    return (\n        <View style={styles.container}>\n            <TouchableOpacity\n                style={{\n                    margin: 10,\n                    padding: 10,\n                    backgroundColor: \"green\",\n                    color: \"white\",\n                }}\n            >\n                Start poll (checks every 20 sec)\n            </TouchableOpacity>\n            <TouchableOpacity\n                style={{\n                    margin: 10,\n                    padding: 10,\n                    backgroundColor: \"red\",\n                    color: \"white\",\n                }}\n            >\n                Stop poll\n            </TouchableOpacity>\n            <TouchableOpacity\n                onPress={() => setWithChecks([])}\n                style={{\n                    margin: 10,\n                    padding: 10,\n                    backgroundColor: \"grey\",\n                    color: \"white\",\n                }}\n            >\n                Clear log\n            </TouchableOpacity>\n            <Text>Log</Text>\n            {withChecks.map((item) => (\n                <View style={{ flexDirection: \"row\", flex: 1 }}>\n                    <View>\n                        <Text>{item.time}</Text>\n                    </View>\n                    <View>\n                        <Text>{item.text}</Text>\n                    </View>\n                </View>\n            ))}\n\n            <TouchableOpacity\n                style={{\n                    margin: 10,\n                    padding: 10,\n                    backgroundColor: \"green\",\n                    color: \"white\",\n                }}\n            >\n                Start without checks\n            </TouchableOpacity>\n            <TouchableOpacity\n                style={{\n                    margin: 10,\n                    padding: 10,\n                    backgroundColor: \"red\",\n                    color: \"white\",\n                }}\n            >\n                Stop\n            </TouchableOpacity>\n            <TouchableOpacity\n                onPress={() => setWithChecks([])}\n                style={{\n                    margin: 10,\n                    padding: 10,\n                    backgroundColor: \"grey\",\n                    color: \"white\",\n                }}\n            >\n                Clear log\n            </TouchableOpacity>\n            <Text>Log</Text>\n            {withChecks.map((item) => (\n                <View style={{ flexDirection: \"row\", flex: 1 }}>\n                    <View>\n                        <Text>{item.time}</Text>\n                    </View>\n                    <View>\n                        <Text>{item.text}</Text>\n                    </View>\n                </View>\n            ))}\n        </View>\n    );\n}\n\nconst styles = StyleSheet.create({\n    container: {\n        flex: 1,\n    },\n    text: {\n        fontSize: 16,\n    },\n});\n"]},"metadata":{},"sourceType":"module"}